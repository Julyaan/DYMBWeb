<!doctype html>
<html class="no-js fixed-layout">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title><%= title %>|大医慢病研究院</title>
  <meta name="description" content="这是一个 index 页面">
  <meta name="keywords" content="index">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="assets/i/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
  <meta name="apple-mobile-web-app-title" content="Amaze UI" />
  <link rel="stylesheet" href="assets/css/amazeui.min.css"/>
  <link rel="stylesheet" href="assets/css/admin.css">
</head>
<body ng-app='routingDemoApp' ng-controller='AppController'>
<!--[if lte IE 9]>
<p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a href="http://browsehappy.com/" target="_blank">升级浏览器</a>
  以获得更好的体验！</p>
<![endif]-->

<header class="am-topbar am-topbar-inverse admin-header">
  <div class="am-topbar-brand">
    <strong>大医慢病研究院</strong> <small>网站后台管理</small>
  </div>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>

  <div class="am-collapse am-topbar-collapse" id="topbar-collapse">

    <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list">
   
      <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          <span class="am-icon-users"></span> 管理员<%= username %> <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
          <li><a href="#"><span class="am-icon-user"></span> 资料</a></li>
          <li><a href="/logoutAdm"><span class="am-icon-power-off"></span> 退出</a></li>
        </ul>
      </li>
      <li class="am-hide-sm-only"><a href="javascript:;" id="admin-fullscreen"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
    </ul>
  </div>
</header>

<div class="am-cf admin-main">
  <!-- sidebar start -->
  <div class="admin-sidebar am-offcanvas" id="admin-offcanvas">
    <div class="am-offcanvas-bar admin-offcanvas-bar">
      <ul class="am-list admin-sidebar-list">
        <li><a href="#/"><span class="am-icon-home"></span> 首页</a></li>
        <li class="admin-parent">
          <a class="am-cf" data-am-collapse="{target: '#collapse-nav1'}"><span class="am-icon-send"></span> 新闻动态 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
          <ul class="am-list am-collapse admin-sidebar-sub " id="collapse-nav1">
            <li><a href="#/add_news"><span class="am-icon-send-o"></span> 新建文章</a></li>
            <li><a href="#/view_news"><span class="am-icon-th"></span> 查看文章
				<span ng-hide="count == 0"class="am-badge am-badge-secondary am-margin-right am-fr">{{ $root.count }}</span>
				
			</a></li>
          </ul>
        </li>
		 <li class="admin-parent">
          <a class="am-cf" data-am-collapse="{target: '#collapse-nav2'}"><span class="am-icon-user"></span> 专家信息 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
          <ul class="am-list am-collapse admin-sidebar-sub " id="collapse-nav2">
            <li><a href="#/add_e"><span class="am-icon-user-plus"></span> 新建</a></li>
            <li><a href="#/view_e"><span class="am-icon-users"></span> 查看</a></li>
          </ul>
        </li>
		<li class="admin-parent">
          <a class="am-cf" data-am-collapse="{target: '#collapse-nav3'}"><span class="am-icon-pencil-square"></span> 慢病研究 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
          <ul class="am-list am-collapse admin-sidebar-sub " id="collapse-nav3">
            <li><a href="#/add_r"><span class="am-icon-file-o"></span> 新建</a></li>
            <li><a href="#/view_r"><span class="am-icon-file-text-o"></span> 查看</a></li>
          </ul>
        </li>
		<li class="admin-parent">
          <a class="am-cf" data-am-collapse="{target: '#collapse-nav4'}"><span class="am-icon-shield"></span> 研究基地 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
          <ul class="am-list am-collapse admin-sidebar-sub " id="collapse-nav4">
            <li><a href="#/add_base"><span class="am-icon-cube"></span> 新建</a></li>
            <li><a href="#/view_base"><span class="am-icon-cubes"></span> 查看</a></li>
          </ul>
        </li>
		<li><a href="admin-table.html"><span class="am-icon-pencil-square-o"></span> 留言管理</a></li>
        <li><a href="admin-table.html"><span class="am-icon-table"></span> 其他</a></li>
        <li><a href="/logoutAdm"><span class="am-icon-sign-out"></span> 注销</a></li>
      </ul>

      <div class="am-panel am-panel-default admin-sidebar-panel">
        <div class="am-panel-bd">
          <p><span class="am-icon-bookmark"></span> 公告</p>
          <p>欢迎登陆大医慢病后台管理系统</p>
        </div>
      </div>

    </div>
  </div>
  <!-- sidebar end -->

  <!-- content start -->
  <div class="admin-content">
    <div ng-view class="admin-content-body">
     
    </div>

    <footer class="admin-content-footer">
      <hr>
      <p class="am-padding-left">© gjy.codeplay all rights reserved.</p>
    </footer>
  </div>
  <!-- content end -->

</div>

<a href="#" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"></a>
<!--提示框  -->	
	
	<div class="am-popup" id="my-popup-success" style="height:164px;width:500px;margin-left:-250px;margin-top:-82px;">
		<div class="am-popup-inner" style="padding-top:58px">
			<div class="am-popup-hd" style="height:58px;padding:5px">
				<h4 class="am-popup-title"><span class="am-icon-md am-icon-btn am-success am-icon-check-circle"></span>&nbsp;文章已发送！</h4>
			</div> 
			<div class="am-popup-bd am-text-center" style="height:60px" id="num1"></div>
			<div class="am-modal-footer">
				<span class="am-modal-btn">确定</span>
			</div>
		</div>
	</div>
	<div class="am-popup" id="my-popup-fail" style="height:164px;width:500px;margin-left:-250px;margin-top:-82px;">
	  <div class="am-popup-inner" style="padding-top:58px">
		<div class="am-popup-hd" style="height:58px;padding:5px">
			<h4 class="am-popup-title"><span class="am-icon-md am-icon-btn am-danger am-icon-exclamation-circle "></span>&nbsp;提交失败</h4>
		</div> 
		<div class="am-popup-bd am-text-center" style="height:60px" id="num2">错误描述：{{$root.err.code}}</div>
		<div class="am-modal-footer">
			<span class="am-modal-btn">确定</span>
		</div>
	  </div>
	</div>
	<div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
	  <div class="am-modal-dialog">
		<div class="am-modal-hd">文章发布提醒</div>
		<div class="am-modal-bd">
		  您确定要将文章《{{$root.titleAlert}}》发布到栏目“{{$root.sortAlert}}”吗？
		</div>
		<div class="am-modal-footer">
		  <span class="am-modal-btn" data-am-modal-cancel>取消</span>
		  <span class="am-modal-btn" data-am-modal-confirm>确定</span>
		</div>
	  </div>
	</div>
<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="assets/js/jquery.min.js"></script>
<!--<![endif]-->
<script src="assets/js/amazeui.min.js"></script>
<script src="assets/js/app.js"></script>
<script src="http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"></script>
<script src="http://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js"></script>
<script src="http://cdn.bootcss.com/angular-sanitize/1.5.8/angular-sanitize.min.js"></script>

<script>
	//设置提交成功的提示弹窗
	var clearNum = 0;
	var counts = 3;//设置3秒后自动消失
	var autoClose_s = function(){
		if(counts>0){
			$("#num1").html(counts + "秒后自动关闭");
			counts--;
		}else if(counts<=0){
			window.clearInterval(clearNum); 
			$("#num1").html("...");
			counts = 3;
		    $("#my-popup-success").modal('close');
		}
	}
	$('#my-popup-success').on('close.modal.amui', function(){
	window.location.href =	"#/view_news";
	});
	
	angular.module('routingDemoApp',['ngRoute', 'ngSanitize'])
	.controller('AppController',function ($scope,$rootScope,myFactory) 
				{
				$rootScope.count= 0
				})
	.controller('NewsController',function ($scope,$rootScope,myFactory) 
				{
				$scope.sorts ={
					"慢病头条":"慢病头条",
					"政策咨询":"政策咨询",
					"学术论文":"学术论文",
					"慢病咨询":"慢病咨询"
					};
				
				$scope.getData = function(){
					$rootScope.count = $rootScope.count + 1;
					$scope.date = $("#date").val();
					var html = ue.getContent();
					//$scope.content = $("#contenCarrier").html();
					$scope.content = html;
					myFactory.setter($scope.title,$scope.source,$scope.date,$scope.sort,$scope.content);
					console.log("add news:it's:"+$scope.content);
					}
				})
	.controller('NewsViewController',function ($scope,$rootScope,$http,myFactory) 
				{
				var getObj = myFactory.getter();
				$rootScope.articles = getObj.articles;
				$scope.articleNum = $rootScope.articles.length;
				$scope.go = function(url){
					console.log("url:"+url);
					//$location.path(url);
					window.location.href =	url;
					}
				$rootScope.send = function(num){
					var formData = $rootScope.articles[num];
					$rootScope.titleAlert = formData.title;
					$rootScope.sortAlert = formData.sort;
					$('#my-confirm').modal({
						relatedTarget: formData,
						onConfirm: function(options) {
							switch(this.relatedTarget.sort)
							{
								case '慢病头条':
									this.relatedTarget.sort = 'sort1';break;
								case '政策咨询':
									this.relatedTarget.sort = 'sort2';break;
								case '学术论文':
									this.relatedTarget.sort = 'sort3';break;
								case '慢病咨询':
									this.relatedTarget.sort = 'sort4';break;
							}
							//console.log(formData);
							console.log("ajax_send:"+JSON.stringify(this.relatedTarget));
							$http({
								method  : 'POST',
								url     : '/admin_send_news',
								data    : JSON.stringify(this.relatedTarget),  
								contentType: "application/json; charset=utf-8",
								dataType: "json", 
								}).error(function(err){
									alert("failed:"+err)
								}).success(function(data){
									if(data == null){
										$rootScope.articles.splice(num,1);
										$('#my-popup-success').modal('open');	
										clearNum = self.setInterval("autoClose_s()",1000);
										$rootScope.count = $rootScope.count - 1;}
									else{
										$rootScope.err =data;
										$('#my-popup-fail').modal('open');	
										}
									
								});
							}
						});
					}					
				
				$http.get("/getnews").success(function (response) {
					$scope.newsList = response;
					$scope.newsNum = $scope.newsList.length;
					});
				$scope.refresh = function(){
					$http.get("/getnews").success(function (response) {
						$scope.newsList = response;
						$scope.newsNum = $scope.newsList.length;
						});
					}	
				})
	.controller('NewsDtlController',function($scope,$routeParams,myFactory)
				{
				var getObj = myFactory.getter();
				var articles = getObj.articles;
				$scope.essay = articles[$routeParams.id];
				$scope.this_num = $routeParams.id
				})
	.controller('NewsEditController',function($scope,$rootScope,$http,$routeParams,myFactory)
				{
				$scope.sorts2 =["慢病头条","政策咨询","学术论文","慢病咨询"];
				var getObj = myFactory.getter();
				var articles = getObj.articles;
				$scope.essay = articles[$routeParams.id];
				$scope.editNum = $routeParams.id;
				$scope.sendEdit = function(num){
					var formData = $scope.essay;
					$rootScope.titleAlert = formData.title;
					$rootScope.sortAlert = formData.sort;
					$('#my-confirm').modal({
						relatedTarget: formData,
						onConfirm: function(options) {
							switch(this.relatedTarget.sort)
							{
								case '慢病头条':
									this.relatedTarget.sort = 'sort1';break;
								case '政策咨询':
									this.relatedTarget.sort = 'sort2';break;
								case '学术论文':
									this.relatedTarget.sort = 'sort3';break;
								case '慢病咨询':
									this.relatedTarget.sort = 'sort4';break;
							}
							//console.log(formData);
							console.log("ajax_send:"+JSON.stringify(this.relatedTarget));
							$http({
								method  : 'POST',
								url     : '/admin_send_news',
								data    : JSON.stringify(this.relatedTarget),  
								contentType: "application/json; charset=utf-8",
								dataType: "json", 
								}).error(function(err){
									alert("failed:"+err)
								}).success(function(data){
									if(data == null){
										$rootScope.articles.splice(num,1);
										$('#my-popup-success').modal('open');	
										clearNum = self.setInterval("autoClose_s()",1000);
										$rootScope.count = $rootScope.count - 1;}
									else{
										$rootScope.err =data;
										$('#my-popup-fail').modal('open');	
										}
									
								});
							}
						});
					
					}
				})
	.controller('NewsGetController',function($scope,$http,$routeParams){
				$http.get("/getnewsinfo?id="+$routeParams.id).success(function (response) {
					$scope.essay = response[0];
					});
		
				})
	.controller('NewsUpdateController',function($scope,$http,$rootScope,$routeParams){
				html_temp = null;
				$scope.sorts2 =["慢病头条","政策咨询","学术论文","慢病咨询"];
				$http.get("/getnewsinfo?id="+$routeParams.id).success(function (response) {
					$scope.essay = response[0];
					html_temp = $scope.essay.news_body;
					});
				$scope.sendNewsUpdated=function(){
					var html = ue2.getContent();
					$scope.essay.news_body = html;
					var formData = $scope.essay
					$rootScope.titleAlert = formData.news_title;
					$rootScope.sortAlert = formData.news_sort;				
					$('#my-confirm').modal({
						relatedTarget: formData,
						onConfirm: function(options) {
							switch(this.relatedTarget.sort)
							{
								case '慢病头条':
									this.relatedTarget.sort = 'sort1';break;
								case '政策咨询':
									this.relatedTarget.sort = 'sort2';break;
								case '学术论文':
									this.relatedTarget.sort = 'sort3';break;
								case '慢病咨询':
									this.relatedTarget.sort = 'sort4';break;
							}
							//console.log(formData);
							console.log("ajax_send:"+JSON.stringify(this.relatedTarget));
							$http({
								method  : 'POST',
								url     : '/admin_update_news_send',
								data    : JSON.stringify(this.relatedTarget),  
								contentType: "application/json; charset=utf-8",
								dataType: "json", 
								}).error(function(err){
									alert("failed:"+err)
								}).success(function(data){
									if(data == null){
										$('#my-popup-success').modal('open');	
										clearNum = self.setInterval("autoClose_s()",1000);
										}
									else{
										$rootScope.err =data;
										$('#my-popup-fail').modal('open');	
										}
									
								});
							}
						});
					}
				})
	.factory('myFactory', function () {   
		//定义参数对象
		var myObject = {};
		myObject.articles = [];
		var _setter = function (title,source,date,sort,content) {
			var data ={};
			data.title = title;
			data.source = source;
			data.date = date;
			data.sort = sort;
			data.content = content;
		    myObject.articles.push(data);     
		   //console.log(myObject.articles.length);
		};

		var _getter = function () {
			return myObject;
		};

		// Public APIs
		// 在controller中通过调setter()和getter()方法可实现提交或获取参数的功能
		return {
			setter: _setter,
			getter: _getter
		};
	})

	.config(['$routeProvider', function($routeProvider){
		$routeProvider
		.when('/',{templateUrl:'admin_home',controller: 'AppController'})
		.when('/add_news',{
				templateUrl:'admin_add_news',
				controller: 'NewsController'
			})
		.when('/view_news',{
				templateUrl:'admin_view_news',
				controller: 'NewsViewController'
			})
		.when('/news_detail/:id',{
				templateUrl:'news_datail.html',
				controller: 'NewsDtlController'
			})
		.when('/news_edit/:id',{
				templateUrl:'admin_edit_news',
				controller: 'NewsEditController'
			})
		.when('/news_get/:id',{
				templateUrl:'admin_get_news.html',
				controller: 'NewsGetController'
			})
		.when('/news_update/:id',{
				templateUrl:'admin_update_news',
				controller: 'NewsUpdateController'
			})
		.when('/add_e',{templateUrl:'admin_add_e'})
		.when('/view_e',{template:'04这是查看新专家页面'})
		.when('/add_r',{template:'05这是发布研究动态页面'})
		.when('/view_r',{template:'06这是查看研究动态页面'})
		.when('/add_base',{template:'07这是发布基地页面'})
		.when('/view_base',{template:'08这是查看基地页面'})

		.otherwise({redirectTo:'/'});
		
	}]);
	


	
</script>
<!-- ---查看新闻详情----- -->	
<script type="text/ng-template" id = 'news_datail.html'>
  
	<div class="am-cf am-padding am-padding-bottom-0">
		<div class="am-fl am-cf">
			<strong class="am-text-primary am-text-lg">新闻动态</strong><small>&nbsp;>>&nbsp;<a href="#/view_news">待发布</a>&nbsp;>>&nbsp;文章详情</small>
		</div>
	</div>

    <hr>
	<div style =" width: 750px; margin: auto;"class="am-tabs am-margin" data-am-tabs>
		<ul class="am-tabs-nav am-nav am-nav-tabs">
		</ul>
	
		<p align="center"><b>{{essay.title}}</b></p>
		<p><b>来源：</b>{{essay.source}}</p>
		<p><b>日期：</b>{{essay.date}}</p>
		<p><b>分类：</b>{{essay.sort}}</p>
		<hr>
		<div ng-bind-html="essay.content"></div> 
		<br><br>
		<div class="am-margin">
			<input  type="button"  ng-click="send(this_num)" class="am-btn am-btn-primary am-btn-default" value = "发布新闻">
		</div> 
	</div>
</script>
<!-- ---从服务器获取新闻内容----- -->	
<script type="text/ng-template" id = 'admin_get_news.html'>
  
	<div class="am-cf am-padding am-padding-bottom-0">
		<div class="am-fl am-cf">
			<strong class="am-text-primary am-text-lg">新闻动态</strong><small>&nbsp;>>&nbsp;<a href="#/view_news">已发布</a>&nbsp;>>&nbsp;文章详情</small>
		</div>
	</div>

    <hr>
	<div style =" width: 750px; margin: auto;"class="am-tabs am-margin" data-am-tabs>
		<ul class="am-tabs-nav am-nav am-nav-tabs">
		</ul>
	
		<p align="center"><b>{{essay.news_title}}</b></p>
		<p><b>来源：</b>{{essay.news_source}}</p>
		<p><b>日期：</b>{{essay.news_date}}</p>
		<p><b>分类：</b>{{essay.news_sort}}</p>
		<hr>
		<div ng-bind-html="essay.news_body"></div> 
		<br><br>
	</div>
</script>

</body>
</html>
